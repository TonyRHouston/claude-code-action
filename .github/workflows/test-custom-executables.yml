name: Test Custom Executables
on:
  workflow_dispatch: {}
jobs:
  test-custom-executables:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683
    - name: Install Bun manually
      run: "echo \"Installing Bun...\"\ncurl -fsSL https://bun.sh/install | bash\n\
        echo \"Bun installed at: $HOME/.bun/bin/bun\"\n\n# Verify Bun installation\n\
        if [ -f \"$HOME/.bun/bin/bun\" ]; then\n  echo \"\u2705 Bun executable found\"\
        \n  $HOME/.bun/bin/bun --version\nelse\n  echo \"\u274C Bun executable not\
        \ found\"\n  exit 1\nfi\n"
    - name: Install Claude Code manually
      run: "echo \"Installing Claude Code...\"\ncurl -fsSL https://claude.ai/install.sh\
        \ | bash -s latest\necho \"Claude Code installed at: $HOME/.local/bin/claude\"\
        \n\n# Verify Claude installation\nif [ -f \"$HOME/.local/bin/claude\" ]; then\n\
        \  echo \"\u2705 Claude executable found\"\n  ls -la \"$HOME/.local/bin/claude\"\
        \nelse\n  echo \"\u274C Claude executable not found\"\n  exit 1\nfi\n"
    - name: Test with both custom executables
      id: custom-test
      uses: ./base-action
      with:
        prompt: 'List the files in the current directory starting with "package"

          '
        anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
        path_to_claude_code_executable: /home/runner/.local/bin/claude
        path_to_bun_executable: /home/runner/.bun/bin/bun
        allowed_tools: LS,Read
    - name: Verify custom executables worked
      run: "OUTPUT_FILE=\"${{ steps.custom-test.outputs.execution_file }}\"\nCONCLUSION=\"\
        ${{ steps.custom-test.outputs.conclusion }}\"\n\necho \"Conclusion: $CONCLUSION\"\
        \necho \"Output file: $OUTPUT_FILE\"\n\nif [ \"$CONCLUSION\" = \"success\"\
        \ ]; then\n  echo \"\u2705 Action completed successfully with both custom\
        \ executables\"\nelse\n  echo \"\u274C Action failed with custom executables\"\
        \n  exit 1\nfi\n\nif [ -f \"$OUTPUT_FILE\" ] && [ -s \"$OUTPUT_FILE\" ]; then\n\
        \  echo \"\u2705 Execution log file created successfully\"\n  if jq . \"$OUTPUT_FILE\"\
        \ > /dev/null 2>&1; then\n    echo \"\u2705 Output is valid JSON\"\n    #\
        \ Verify the task was completed\n    if grep -q \"package\" \"$OUTPUT_FILE\"\
        ; then\n      echo \"\u2705 Claude successfully listed package files\"\n \
        \   else\n      echo \"\u26A0\uFE0F Could not verify if package files were\
        \ listed\"\n    fi\n  else\n    echo \"\u274C Output is not valid JSON\"\n\
        \    exit 1\n  fi\nelse\n  echo \"\u274C Execution log file not found or empty\"\
        \n  exit 1\nfi\n"
